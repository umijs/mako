#!/bin/bash

# get cpu & os info
OS=$(uname -s | tr '[:upper:]' '[:lower:]')
ARCH=$(uname -m)

if [ "$ARCH" = "x86_64" ]; then
    ARCH="x64"
elif [ "$ARCH" = "aarch64" ] || [ "$ARCH" = "arm64" ]; then
    ARCH="arm64"
fi

# prepare PACKAGE_NAME
PACKAGE_NAME="@utoo/{{name}}-${OS}-${ARCH}"

# check the binary node_modules exist
if [ ! -d "node_modules/${PACKAGE_NAME}" ]; then
    echo "Binary package ${PACKAGE_NAME} not found"
    exit 1
fi

# create binary config
mkdir -p bin

# copy file
cp -f "node_modules/${PACKAGE_NAME}/bin/{{name}}" "bin/{{name}}"
chmod +x "bin/{{name}}"
